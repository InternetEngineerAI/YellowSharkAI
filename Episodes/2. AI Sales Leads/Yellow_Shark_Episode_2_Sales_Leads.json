{
  "name": "Yellow Shark Mill Company · Sales Route Assistant",
  "version": "2.1",
  "trigger_phrases": [
    "start shark"
  ],
  "default_language": "English",
  "supported_languages": [
    "English",
    "Español"
  ],
  "description": "Automates bakery lead generation, cleaning, and export for Yellow Shark Mill Company.",
  "on_trigger": {
    "message_bilingual": "Welcome to Yellow Shark Mill Company Sales Ops Assistant.\nWe’ll help you build bakery leads for outbound calls and in-person routes.\n\nBienvenido al Asistente de Ventas de Yellow Shark Mill Company.\nTe ayudaremos a crear y organizar leads de panaderías para llamadas y visitas.\n\nChoose your language / Elige tu idioma:\n1. English\n2. Español",
    "next_state": "LANG_SELECT"
  },
  "states": {
    "LANG_SELECT": {
      "type": "choice",
      "choices": {
        "1": {
          "set_language": "English",
          "next_state": "TARGET_MARKET"
        },
        "2": {
          "set_language": "Español",
          "next_state": "TARGET_MARKET"
        }
      }
    },
    "TARGET_MARKET": {
      "prompt_en": "Which bakeries do you want to target?\n1) Regional Chain Bakeries (5–100 locations)\n2) Artisan / High-End Bakeries\n3) Both",
      "prompt_es": "¿Qué panaderías deseas targetear?\n1) Cadenas regionales (5–100 locales)\n2) Artesanales / Alta gama\n3) Ambas",
      "choices": {
        "1": {
          "set": {
            "segment": "RegionalChain"
          },
          "next_state": "LEAD_SOURCE"
        },
        "2": {
          "set": {
            "segment": "ArtisanHighEnd"
          },
          "next_state": "LEAD_SOURCE"
        },
        "3": {
          "set": {
            "segment": "Both"
          },
          "next_state": "LEAD_SOURCE"
        }
      }
    },
    "LEAD_SOURCE": {
      "prompt_en": "Where should we get leads?\n1) Gemini\n2) Microsoft Copilot\n3) Grok\n4) Upload CSV",
      "prompt_es": "¿De dónde obtenemos los leads?\n1) Gemini\n2) Microsoft Copilot\n3) Grok\n4) Subir CSV",
      "choices": {
        "1": {
          "set": {
            "source": "Gemini"
          },
          "next_state": "CLEAN_ENRICH"
        },
        "2": {
          "set": {
            "source": "Copilot"
          },
          "next_state": "CLEAN_ENRICH"
        },
        "3": {
          "set": {
            "source": "Grok"
          },
          "next_state": "CLEAN_ENRICH"
        },
        "4": {
          "expect_upload": true,
          "validate_schema": true,
          "preview_rows": 5,
          "next_state": "CLEAN_ENRICH"
        }
      }
    },
    "CLEAN_ENRICH": {
      "announce_en": "Cleaning and normalizing leads.",
      "announce_es": "Limpiando y normalizando leads.",
      "actions": [
        {
          "add_lead_id": "YSMC-{YYYYMMDD}-{SEQ4}"
        },
        {
          "normalize_state_to_usps": true
        },
        {
          "format_phone_email": true
        },
        {
          "tag_segment_from_selection_or_keywords": true
        }
      ],
      "prompt_en": "Enrich with public contacts (Owner/Buyer/Head Baker)? (yes/no)",
      "prompt_es": "¿Enriquecer con contactos públicos (Dueño/Comprador/Maestro Panadero)? (sí/no)",
      "choices": {
        "yes": {
          "perform": [
            "enrich_contacts_public"
          ],
          "next_state": "ROUTING"
        },
        "sí": {
          "perform": [
            "enrich_contacts_public"
          ],
          "next_state": "ROUTING"
        },
        "no": {
          "next_state": "ROUTING"
        }
      }
    },
    "ROUTING": {
      "prompt_en": "Generate a route? 1) Walkable  2) Driving  3) Skip",
      "prompt_es": "¿Generar ruta? 1) A pie  2) En auto  3) Omitir",
      "choices": {
        "1": {
          "set": {
            "route_mode": "walk"
          },
          "perform": [
            "geocode",
            "nearest_neighbor_route"
          ],
          "next_state": "MAPS_LINKS"
        },
        "2": {
          "set": {
            "route_mode": "drive"
          },
          "perform": [
            "geocode",
            "nearest_neighbor_route"
          ],
          "next_state": "MAPS_LINKS"
        },
        "3": {
          "next_state": "EXPORTS"
        }
      },
      "routing_rules": {
        "keep_first_as_start": true,
        "distance_metric": "haversine_meters",
        "outputs": [
          "Latitude",
          "Longitude",
          "WalkOrder",
          "DistanceFromPrevMeters"
        ]
      }
    },
    "MAPS_LINKS": {
      "announce_en": "Adding Google Maps links.",
      "announce_es": "Agregando enlaces de Google Maps.",
      "formula_excel": "=HYPERLINK(\"https://www.google.com/maps/search/?api=1&query=\" & ENCODEURL({FullAddressCell}), \"Open in Google Maps\")",
      "output_field": "GoogleMapsLink",
      "next_state": "EXPORTS"
    },
    "EXPORTS": {
      "prompt_en": "Choose export format(s): 1) Master CSV  2) RingOver  3) ReadyMode  4) Generic Dialer  5) All",
      "prompt_es": "Elige formato(s): 1) Master CSV  2) RingOver  3) ReadyMode  4) Dialer Genérico  5) Todos",
      "choices": {
        "1": {
          "export": [
            "master_csv"
          ],
          "next_state": "DONE"
        },
        "2": {
          "export": [
            "ringover_csv"
          ],
          "next_state": "DONE"
        },
        "3": {
          "export": [
            "readymode_csv"
          ],
          "next_state": "DONE"
        },
        "4": {
          "export": [
            "generic_dialer_csv"
          ],
          "next_state": "DONE"
        },
        "5": {
          "export": [
            "master_csv",
            "ringover_csv",
            "readymode_csv",
            "generic_dialer_csv"
          ],
          "next_state": "DONE"
        }
      }
    },
    "DONE": {
      "message_en": "Your files are ready. You can open them in Excel or import into your dialer.",
      "message_es": "Tus archivos están listos. Ábrelos en Excel o impórtalos en tu marcador.",
      "end": true
    }
  },
  "master_schema": {
    "headers": [
      "LeadId",
      "CompanyName",
      "Segment",
      "LocationCount",
      "ContactFirst",
      "ContactLast",
      "Title",
      "Phone",
      "AltPhone",
      "Email",
      "Website",
      "Address",
      "City",
      "State",
      "PostalCode",
      "Country",
      "Timezone",
      "DNCFlag",
      "Notes",
      "Latitude",
      "Longitude",
      "GoogleMapsLink",
      "WalkOrder",
      "DistanceFromPrevMeters"
    ],
    "rules": {
      "lead_id_pattern": "YSMC-YYYYMMDD-SEQ4",
      "segment_values": [
        "RegionalChain",
        "ArtisanHighEnd"
      ],
      "timezone_infer_from_geocode": true,
      "dnc_default": "No",
      "csv_encoding": "UTF-8",
      "quote_minimal": true
    }
  },
  "dialer_mappings": {
    "ringover": {
      "headers": [
        "number",
        "name",
        "company",
        "email",
        "address",
        "city",
        "state",
        "zip",
        "country",
        "notes",
        "custom_1",
        "custom_2"
      ],
      "map": {
        "number": "Phone",
        "name": "concat(ContactFirst,' ',ContactLast, fallback CompanyName)",
        "company": "CompanyName",
        "email": "Email",
        "address": "Address",
        "city": "City",
        "state": "State",
        "zip": "PostalCode",
        "country": "Country",
        "notes": "Notes",
        "custom_1": "GoogleMapsLink",
        "custom_2": "LeadId"
      }
    },
    "readymode": {
      "headers": [
        "phone",
        "first_name",
        "last_name",
        "company",
        "address",
        "city",
        "state",
        "postal_code",
        "country",
        "list_name",
        "notes"
      ],
      "map": {
        "phone": "Phone",
        "first_name": "ContactFirst",
        "last_name": "ContactLast",
        "company": "CompanyName",
        "address": "Address",
        "city": "City",
        "state": "State",
        "postal_code": "PostalCode",
        "country": "Country",
        "list_name": "Segment",
        "notes": "Notes"
      }
    },
    "generic": {
      "headers": [
        "phone",
        "company",
        "first_name",
        "last_name",
        "title",
        "email",
        "address",
        "city",
        "state",
        "zip",
        "country",
        "timezone",
        "notes",
        "external_id"
      ],
      "map": {
        "phone": "Phone",
        "company": "CompanyName",
        "first_name": "ContactFirst",
        "last_name": "ContactLast",
        "title": "Title",
        "email": "Email",
        "address": "Address",
        "city": "City",
        "state": "State",
        "zip": "PostalCode",
        "country": "Country",
        "timezone": "Timezone",
        "notes": "Notes",
        "external_id": "LeadId"
      }
    }
  },
  "gemini_sub_instructions": {
    "objective": "Geocode, route-optimize, add Excel Google Maps links, and export CSVs compatible with master and dialers.",
    "steps": [
      "Create FullAddress = Address + ', ' + City + ', ' + State + ' ' + PostalCode + ', ' + Country (trim extras).",
      "Geocode each FullAddress to Latitude/Longitude (WGS84). If unresolved, leave blank and append '[Geocode uncertain]' to Notes.",
      "Perform nearest-neighbor routing. Keep first row as start unless StartAt is provided.",
      "Add WalkOrder and DistanceFromPrevMeters (0 for first).",
      "Add Excel Maps hyperlink column using formula template and correct FullAddress cell reference.",
      "Export UTF-8 CSV for master + RingOver + ReadyMode + Generic mappings; preserve all original fields."
    ],
    "do_not": [
      "Do not drop rows on geocode failure.",
      "Do not change phone/email values (normalize only).",
      "Do not reorder across distant cities unless MaxWalkRadiusKm is provided."
    ]
  },
  "validation": {
    "dedupe_keys": [
      "Phone",
      "Website",
      "Address"
    ],
    "state_format": "USPS-2",
    "email_regex": "standard",
    "phone_format": "E.164 where possible, else national format"
  },
  "compliance": {
    "dnc_flag_field": "DNCFlag",
    "local_call_window_default": "08:00-18:00 local",
    "notes_uncertain_suffix": "[Uncertain]"
  },
  "ui": {
    "progress_messages": {
      "geocoding_en": "Geocoding {{count}} bakeries...",
      "geocoding_es": "Geocodificando {{count}} panaderías...",
      "routing_en": "Sorting route by proximity...",
      "routing_es": "Ordenando ruta por proximidad...",
      "export_en": "Preparing CSV exports...",
      "export_es": "Preparando exportaciones CSV..."
    }
  },
  "ai_instruction_blocks": {
    "links": {
      "gemini": "https://gemini.google.com/",
      "copilot": "https://copilot.microsoft.com/",
      "grok": "https://grok.com/"
    },
    "gemini": {
      "title": "Gemini Instructions (Full Data Integrity Rule)",
      "final_critical_step": true,
      "headers": [
        "CompanyName",
        "ContactName",
        "Address",
        "City",
        "State",
        "PostalCode",
        "Country",
        "Phone",
        "Email",
        "Website"
      ],
      "prompt_template": "Retrieve a list of Regional Chain Bakeries and Artisan/High-End Bakeries located in {{TargetLocation}}.\n\nInclude only bakeries that bake in-house and purchase flour by pallet or bulk.\nExclude supermarkets, cafés, and national chains.\n\nFor each bakery, provide:\n- Company name\n- Contact person or owner (if available)\n- Address, city, state, postal code, and country\n- Phone number\n- Email (if available)\n- Website (if available)\n\nDATA INTEGRITY RULE:\nFor proprietary fields (Owner/Contact Person and Email), leave blank if not publicly available.\nFor public-facing fields (Address, Phone Number, Website), perform all reasonable search functions to locate and fill these fields.\nDo not leave these fields blank if they can be easily verified through a standard Google search.\n\nFINAL, CRITICAL STEP (MUST BE EXECUTED LAST):\nReturn the data ONLY as RAW CSV TEXT — no markdown tables, no summaries, no explanations — using these exact headers:\nCompanyName, ContactName, Address, City, State, PostalCode, Country, Phone, Email, Website"
    },
    "copilot": {
      "title": "Microsoft Copilot Instructions (Partial Data Integrity Rule)",
      "final_critical_step": true,
      "headers": [
        "CompanyName",
        "ContactName",
        "Address",
        "City",
        "State",
        "PostalCode",
        "Country",
        "Phone",
        "Email",
        "Website"
      ],
      "prompt_template": "Search for bakeries in {{TargetLocation}} that meet these criteria:\n\n- Regional Chain (5–100 locations) or Artisan/High-End\n- Bakes in-house\nExclude grocery stores, cafés, and nationwide franchises.\n\nFor each bakery, include:\n- Company name\n- Contact person or owner (if available)\n- Address, city, state, postal code, and country\n- Phone number\n- Email (if available)\n- Website (if available)\n\nDATA QUALITY REQUIREMENT:\nIf the phone number or primary address is missing, perform a targeted web search to complete those fields before finalizing the table.\n\nFINAL, CRITICAL STEP (MUST BE EXECUTED LAST):\nReturn the results ONLY as PLAIN CSV TEXT — no markdown formatting, no commentary — using these headers:\nCompanyName, ContactName, Address, City, State, PostalCode, Country, Phone, Email, Website"
    },
    "grok": {
      "title": "Grok Instructions (Simplified Integrity Directive)",
      "final_critical_step": true,
      "headers": [
        "CompanyName",
        "ContactName",
        "Address",
        "City",
        "State",
        "PostalCode",
        "Country",
        "Phone",
        "Website"
      ],
      "prompt_template": "List all Regional Chain and Artisan/High-End Bakeries in {{TargetLocation}}.\n\nInclude for each:\n- Company name\n- Contact person or owner (if available)\n- Address, city, state, postal code, and country\n- Phone number\n- Website (if available)\n\nDATA COMPLETENESS RULE:\nIf the phone number or primary address is missing, perform an additional search to locate and fill those fields before finalizing the table.\n\nFINAL, CRITICAL STEP (MUST BE EXECUTED LAST):\nReturn the data ONLY as RAW CSV TEXT (NO markdown tables, NO explanations) using these headers:\nCompanyName, ContactName, Address, City, State, PostalCode, Country, Phone, Website"
    }
  },
  "fallback_summaries": {
    "gemini": "Retrieve bakery leads in [TargetLocation], include company name, owner, address, phone, email, and website. Verify phone/address via web search. Return only raw CSV text.",
    "copilot": "Search bakeries in [TargetLocation], baking in-house, exclude chains and cafés. Fill missing phone/address before output. Return only raw CSV.",
    "grok": "List bakeries in [TargetLocation], include name, owner, address, phone, and website. Ensure phone/address filled. Return raw CSV only."
  },
  "meta": {
    "last_updated": "2025-11-10T04:03:19.638196Z",
    "author": "Internet Engineer",
    "notes": "Restored full state machine and added AI instruction blocks plus fallback summaries."
  }
}